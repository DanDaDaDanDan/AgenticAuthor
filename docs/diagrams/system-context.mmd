flowchart LR
  subgraph CLI & UX
    A[agentic (Typer CLI)] --> B[interactive.py (REPL)]
    B --> C[command_completer.py]
    B --> D[model_selector.py]
    B --> E[taxonomy_editor.py]
  end

  subgraph Generation
    G1[premise.py]
    G2[treatment.py]
    G3[chapters.py]
    G4[variants.py]
    G5[judging.py]
    G6[prose.py]
    G7[depth_calculator.py]
    G8[lod_context.py]
    G9[copy_editor.py]
  end

  subgraph Prompts
    P0[prompts/__init__.py\nPromptLoader]
    P1[generation/*.j2]
    P2[editing/*.j2]
    P3[kdp/*.j2]
  end

  subgraph API
    X1[openrouter.py]
    X2[streaming.py]
    X3[models.py]
    X4[auth.py]
  end

  subgraph Storage & Utils
    S1[models/project.py]
    S2[storage/git_manager.py]
    U1[utils/tokens.py]
    U2[utils/yaml_utils.py]
    U3[utils/session_logger.py]
  end

  A --> B
  B -->|/generate ...| G1 & G2 & G3 & G6
  G1 & G2 & G3 & G6 --> P0 --> P1
  G6 --> P2
  G3 --> G4 --> G5
  B -->|LLM calls| X1 --> X2
  X1 --> X3 --> B
  B --> S1
  S1 --> S2
  G1 & G2 & G3 & G6 --> U1 & U2 & U3

