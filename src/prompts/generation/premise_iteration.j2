{#
    Premise iteration prompt - regenerate premise based on user feedback.

    Variables:
    - iteration_context: Full context string with feedback, history, judge feedback
    - old_content: Current premise as JSON string
    - attempt: Current attempt number
#}

[SYSTEM]
You are a professional story premise developer. You excel at refining story concepts based on feedback while maintaining narrative coherence. You always return valid JSON without additional formatting.

[USER]
You are revising a story premise based on user feedback.

{{ iteration_context }}

CURRENT PREMISE:
```json
{{ old_content }}
```

TASK:
Revise the premise to address the user's feedback while maintaining story coherence.

GUIDELINES:
1. **Address the Feedback**: Directly implement what the user requested
2. **Surgical Precision**: Make ONLY the changes necessary to address feedback
   - Identify: What MUST change (specific elements mentioned in feedback)
   - Identify: What MAY need adjustment (related elements for consistency)
   - Identify: What MUST NOT change (working elements not mentioned)
3. **Ripple Effect Management**: Adjust related premise elements ONLY when necessary
   - If feedback changes protagonist motivation, adjust related stakes but preserve unrelated elements
   - If feedback changes antagonist, update their connection to protagonist but keep unrelated plot elements
   - Make minimum necessary changes to maintain internal coherence
4. **Preserve Detail**: Retain existing premise strength in unchanged elements
   - Don't simplify or generalize elements not mentioned in feedback
   - Keep specific details, character traits, and plot hooks that work
   - Maintain the same level of richness and specificity throughout
5. **Avoid Overcorrection**: Don't introduce new issues while fixing requested ones
   - Don't lose good premise elements while making changes
   - Don't create new inconsistencies or logical problems
   - Stay focused on the actual feedback, not imagined improvements
6. **Respect Taxonomy**: Keep taxonomy selections unless feedback explicitly asks to change them
7. **Be Complete**: Return a full premise with all elements, changed and unchanged

RETURN FORMAT:
Return ONLY valid JSON (no markdown fences):

{
  "text": "The complete revised premise text (2-4 paragraphs, 100-300 words)",
  "taxonomy": {
    "genre": "primary_genre",
    "length_scope": "novel/novella/short_story/etc",
    "narrative_structure": "three_act/hero_journey/etc",
    "pacing": "fast/moderate/slow",
    "tone": "dark/light/etc",
    "point_of_view": "first_person/third_limited/etc",
    "tense": "past/present",
    "setting_era": "contemporary/historical/future/etc",
    "themes": ["theme1", "theme2", "theme3"]
  }
}

IMPORTANT:
- The "text" field should be complete, polished premise text
- Include ALL taxonomy fields even if unchanged
- Focus changes on what the user requested
- Maintain narrative quality and coherence
- Temperature is 0.7 for creative but focused iteration

Write the revised premise now:
