{#
    Prose full iteration prompt - regenerate all prose based on user feedback.

    Variables:
    - iteration_context: Full context with feedback, history, judge feedback
    - old_content: Current prose (all chapters)
    - attempt: Current attempt number
#}

[SYSTEM]
You are a professional fiction writer. Return only the prose text without any formatting or explanations.

[USER]
You are revising the complete prose for a story based on user feedback.

{{ iteration_context }}

CURRENT PROSE (all chapters):
```
{{ old_content }}
```

TASK:
Revise the complete prose to address the user's feedback while maintaining story quality and coherence.

GUIDELINES:
1. **Address the Feedback**: Directly implement what the user requested
2. **Surgical Precision**: Make ONLY the changes necessary to address feedback
   - Identify: What MUST change (specific scenes, dialogue, descriptions mentioned in feedback)
   - Identify: What MAY need adjustment (related scenes, character reactions, consequences)
   - Identify: What MUST NOT change (scenes, chapters, or elements not mentioned)
3. **Ripple Effect Management**: Adjust related prose ONLY when necessary for consistency
   - If feedback changes a scene in Chapter 3, adjust immediate consequences but preserve unrelated chapters
   - If feedback changes dialogue, update character reactions but keep unrelated dialogue intact
   - If feedback changes tone, apply it where needed but preserve working passages
   - Make minimum necessary changes to maintain story coherence
4. **Preserve Detail & Voice**: Retain existing prose quality in unchanged passages
   - Don't rewrite chapters not mentioned in feedback
   - Keep specific descriptions, dialogue, and narrative voice that work
   - Maintain the same prose quality and style throughout
   - Don't simplify or generalize passages not mentioned in feedback
5. **Avoid Overcorrection**: Don't introduce new problems while fixing requested ones
   - Don't lose good prose, scenes, or character moments while making changes
   - Don't create new inconsistencies or narrative issues
   - Don't over-revise areas adjacent to changes
   - Stay focused on the actual feedback, not imagined improvements
6. **Be Complete**: Return ALL chapters with both changed and unchanged content

PROSE STRUCTURE:
Return all chapters separated by `---` markers:

```
[Chapter 1 prose text]

---

[Chapter 2 prose text]

---

[Continue for all chapters]
```

IMPORTANT:
- Return ONLY the prose text, no chapter headers or numbering
- Separate chapters with `---` on its own line surrounded by blank lines
- Focus changes on what the user requested
- Maintain narrative quality and flow
- Keep the same number of chapters as the original
- Temperature is 0.8 for creative but controlled iteration

Write the revised prose now:
