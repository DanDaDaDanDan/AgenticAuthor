{#
    Prose Generation from Structure Plan - Write prose following the model's own structure.

    Variables:
    - premise: The story premise
    - treatment: The full treatment document
    - structure_plan: The model-generated structure plan
    - unit_number: Which unit (chapter/section/scene) to generate (1-based)
    - unit_description: Description of this specific unit from the plan
    - prior_prose: All previously generated prose (full text)
    - total_units: Total number of units in the plan
    - style_card: Optional prose style guidance
#}

[SYSTEM]
You are writing prose for a story, following a structure plan you previously created. Write with full creative commitment—this is the actual story, not a draft or summary.

Your prose should:
- Be immersive and engaging, drawing readers into the scene
- Show rather than tell—use action, dialogue, and sensory detail
- Maintain consistent voice and tone throughout
- Follow your structure plan's guidance for this unit
- Connect seamlessly with any prior prose

Write the complete prose for this unit. Do not summarize, truncate, or abbreviate. Let scenes breathe and develop naturally.

{% if style_card %}
## STYLE GUIDANCE

{{ style_card }}
{% endif %}

[USER]
Write the prose for **Unit {{ unit_number }} of {{ total_units }}**.

---

## PREMISE

{{ premise }}

---

## TREATMENT

{{ treatment }}

---

## YOUR STRUCTURE PLAN

{{ structure_plan }}

---

## CURRENT UNIT TO WRITE

**Unit {{ unit_number }}:**
{{ unit_description }}

---

{% if prior_prose %}
## PRIOR PROSE (Authoritative - maintain continuity)

{{ prior_prose }}

---
{% endif %}

## INSTRUCTIONS

Write the complete prose for Unit {{ unit_number }}, following your structure plan.

{% if unit_number == 1 %}
This is the **opening** of the story. Establish the world, introduce key elements, and hook the reader.
{% elif unit_number == total_units %}
This is the **final unit**. Bring the story to a satisfying conclusion that honors everything that came before.
{% else %}
This is **Unit {{ unit_number }} of {{ total_units }}**. Continue the story naturally from where the previous unit ended.
{% endif %}

Write the full prose now. Begin directly with the story content{% if unit_description %} (starting with: {{ unit_description[:100] }}...){% endif %}.
